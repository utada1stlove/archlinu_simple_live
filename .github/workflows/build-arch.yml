name: build-archlinux

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build in Arch Linux (Docker)
        run: |
          docker run --rm -t \
            -v "$GITHUB_WORKSPACE:/work" \
            -w /work \
            archlinux:latest \
            bash -lc '
              set -euxo pipefail
              pacman-key --init
              pacman-key --populate archlinux
              pacman -Syu --noconfirm
              pacman -S --noconfirm --needed \
                base-devel git curl unzip zip tar \
                cmake ninja pkgconf \
                gtk3 glib2 pango cairo gdk-pixbuf2 \
                mpv

              # ====== 下面按项目类型改（先用 Flutter 版，若不是 Flutter 再改）======
              if [ -f pubspec.yaml ]; then
                git clone https://github.com/flutter/flutter.git -b stable --depth 1 /opt/flutter
                export PATH=/opt/flutter/bin:$PATH
                flutter --version
                flutter config --enable-linux-desktop
                flutter pub get
                flutter build linux --release
                mkdir -p dist
                tar -C build/linux/x64/release -czf dist/simple_live_app-archlinux-x86_64.tar.gz bundle
              else
                echo "No pubspec.yaml found. Please replace build commands for your project type."
                ls -la
                exit 1
              fi
            '

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: simple_live_app-archlinux-x86_64
          path: dist/*.tar.gz
